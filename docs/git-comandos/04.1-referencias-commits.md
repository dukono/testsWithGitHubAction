# 4.1 Referencias de Commits: ~, ^, y {}

[ğŸ  Volver al Ãndice](../../GIT_COMANDOS_GUIA_PRACTICA.md)

---

## 4.1. Referencias de Commits: ~, ^, y {}
[â¬†ï¸ Top](#tabla-de-contenidos)

**Â¿QuÃ© son?**
Son operadores especiales para referenciar commits relativos a una posiciÃ³n dada (como HEAD o nombre de rama).

### Operador `~` (Tilde) - NavegaciÃ³n Hacia AtrÃ¡s por Primera LÃ­nea

**Significado:** Navega hacia atrÃ¡s en la historia siguiendo siempre la **primera lÃ­nea de commits**.

```
HEAD~1  â†’ 1 commit antes de HEAD (equivalente a HEAD^)
HEAD~2  â†’ 2 commits antes de HEAD
HEAD~3  â†’ 3 commits antes de HEAD
HEAD~n  â†’ n commits antes de HEAD siguiendo la primera lÃ­nea
```

**VisualizaciÃ³n:** [ğŸ”™](#41-referencias-de-commits---y-)

```
A â† B â† C â† D â† E (HEAD)
â”‚   â”‚   â”‚   â”‚   â”‚
~4  ~3  ~2  ~1  ~0 (o simplemente HEAD)
```

**Ejemplos prÃ¡cticos:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
# Ver el commit de hace 3 commits
git show HEAD~3

# Comparar con 5 commits atrÃ¡s
git diff HEAD~5 HEAD

# Resetear al commit anterior
git reset --soft HEAD~1

# Ver cambios de un archivo hace 2 commits
git show HEAD~2:archivo.txt
```

---

### Operador `^` (Caret) - SelecciÃ³n de LÃ­neas en Merges

**Significado:** Selecciona **quÃ© lÃ­nea de commits** seguir cuando un commit tiene mÃºltiples lÃ­neas de historia (merge commits).

```
HEAD^1  â†’ Primera lÃ­nea de commits (default, equivalente a HEAD^)
HEAD^2  â†’ Segunda lÃ­nea de commits (rama mergeada)
HEAD^3  â†’ Tercera lÃ­nea de commits (raro, en octopus merge)
```

**VisualizaciÃ³n de merge:** [ğŸ”™](#41-referencias-de-commits---y-)

```
    A â† B â† C (rama feature)
   /         \
  D â† E â† F â† M (HEAD en main)
              â”‚
         HEAD^1 = F (primera lÃ­nea, main)
         HEAD^2 = C (segunda lÃ­nea, rama mergeada)
         HEAD^3 = A (tercera lÃ­nea, en octopus merge)
```

**Ejemplos prÃ¡cticos:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
# Ver quÃ© entrÃ³ desde la rama mergeada
git log HEAD^2

# Comparar con la primera lÃ­nea (rama principal)
git diff HEAD^1 HEAD

# Ver los cambios de la segunda lÃ­nea
git show HEAD^2

# Comparar ambas lÃ­neas
git diff HEAD^1 HEAD^2
```

---

### Combinando `~` y `^`

**Se pueden combinar para navegaciÃ³n compleja:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
HEAD~2^2   â†’ Segunda lÃ­nea del commit que estÃ¡ 2 commits atrÃ¡s (si ese commit es un merge)
HEAD^^     â†’ Equivalente a HEAD~2 (2 commits atrÃ¡s)
HEAD^2~3   â†’ Tres commits atrÃ¡s desde la segunda lÃ­nea
```

**Ejemplo visual bÃ¡sico:** [ğŸ”™](#41-referencias-de-commits---y-)

```
        A â† B â† C
       /         \
  D â† E â† F â† G â† M (HEAD)

HEAD      â†’ M (merge commit)
HEAD~1    â†’ G (1 commit atrÃ¡s)
HEAD~2    â†’ W (2 commits atrÃ¡s, tambiÃ©n es merge)
HEAD~2^1  â†’ B (primera lÃ­nea del commit W)
HEAD~2^2  â†’ Y (segunda lÃ­nea del commit W)

Nota: HEAD~2^2 solo existe si el commit que estÃ¡ 2 commits atrÃ¡s (W) es un merge.
      Si W no tiene segunda lÃ­nea, HEAD~2^2 darÃ¡ error.
```

**Ejemplo visual con HEAD~2^2:** [ğŸ”™](#41-referencias-de-commits---y-)

```
    X â† Y          (rama lateral)
   /     \
  A â† B â† W â† G â† M (HEAD)

HEAD      â†’ M (merge commit)
HEAD~1    â†’ G (1 commit atrÃ¡s)
HEAD~2    â†’ W (2 commits atrÃ¡s, tambiÃ©n es merge)
HEAD~2^1  â†’ B (primera lÃ­nea del commit W)
HEAD~2^2  â†’ Y (segunda lÃ­nea del commit W)

Nota: HEAD~2^2 solo funciona si el commit que estÃ¡ 2 commits atrÃ¡s (W) es un merge.
      Si W no tiene segunda lÃ­nea, HEAD~2^2 darÃ¡ error.
```

**Ejemplos prÃ¡cticos:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
# Ver el tercer commit de la segunda lÃ­nea
git show HEAD^2~3

# Comparar ancestros complejos
git diff HEAD~3 HEAD^2~1

# Resetear a ancestro complejo
git reset HEAD^^
```

---

### Operador `{}` (Reflog) - Historial de Movimientos

**Significado:** Accede al **historial de posiciones previas** de una referencia (HEAD, ramas, etc.).

```
HEAD@{0}  â†’ PosiciÃ³n actual
HEAD@{1}  â†’ DÃ³nde estaba HEAD en la operaciÃ³n anterior
HEAD@{2}  â†’ Dos operaciones atrÃ¡s
HEAD@{n}  â†’ n-Ã©sima operaciÃ³n atrÃ¡s
```

**Â¿QuÃ© operaciones mueven HEAD?**
- commit, checkout, merge, pull, reset, rebase, cherry-pick, etc.

**VisualizaciÃ³n:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
git reflog
# Salida:
abc1234 HEAD@{0}: commit: Added feature X
def5678 HEAD@{1}: checkout: moving from main to feature
9ab0cde HEAD@{2}: pull: Fast-forward
```

**Ejemplos prÃ¡cticos:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
# Ver dÃ³nde estaba HEAD hace 3 operaciones
git show HEAD@{3}

# Volver al estado antes del Ãºltimo pull
git reset --hard HEAD@{1}

# Ver commits traÃ­dos en el Ãºltimo pull
git log HEAD@{1}..HEAD --oneline

# Ver diferencias con estado previo
git diff HEAD@{1} HEAD

# Reflog de una rama especÃ­fica
git reflog show feature-branch

# Ver estado hace 2 dÃ­as
git show HEAD@{2.days.ago}

# Ver estado a una fecha especÃ­fica
git show main@{2024-01-15}
```

---

### Tabla Resumen de Referencias

| Operador | PropÃ³sito | Ejemplo | Resultado |
|----------|-----------|---------|-----------|
| `~n` | n commits atrÃ¡s (primera lÃ­nea) | `HEAD~3` | 3 commits antes de HEAD |
| `^n` | n-Ã©sima lÃ­nea (en merges) | `HEAD^2` | Segunda lÃ­nea del merge |
| `@{n}` | n-Ã©sima posiciÃ³n anterior (reflog) | `HEAD@{5}` | DÃ³nde estaba hace 5 ops |
| `^^` | Equivalente a `~2` | `HEAD^^` | 2 commits atrÃ¡s |
| `~n^m` | CombinaciÃ³n | `HEAD~2^2` | 2Âª lÃ­nea del commit que estÃ¡ 2 atrÃ¡s |
| `@{time}` | PosiciÃ³n en fecha/tiempo | `HEAD@{yesterday}` | Estado de ayer |

---

### Casos de Uso PrÃ¡cticos

**1. Ver quÃ© traÃ­do en un pull:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
git log HEAD@{1}..HEAD --oneline
git diff HEAD@{1} HEAD --name-status
```

**2. Deshacer el Ãºltimo commit manteniendo cambios:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
git reset --soft HEAD~1
```

**3. Ver quÃ© se mergeÃ³ desde una rama:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
# Solo funciona si HEAD es un merge commit
git log HEAD^2 --oneline

# Si HEAD no es merge, usa el hash del merge:
git log <hash-merge>^2 --oneline
# O si sabes que el merge estÃ¡ 2 commits atrÃ¡s:
git log HEAD~2^2 --oneline
```

**4. Recuperar trabajo perdido:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
git reflog
git switch -c recuperado HEAD@{5}  # Crea rama desde ese punto
# o para solo ver:
git switch --detach HEAD@{5}  # Detached HEAD para inspecciÃ³n
```

**5. Comparar con versiÃ³n de ayer:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
git diff HEAD@{yesterday} HEAD
```

**6. Ver ancestros en merge complejo:**
```bash
# Ver commits Ãºnicos del segundo padre
git log HEAD^1..HEAD^2 --oneline
```

---

### Diferencias Clave

**`HEAD~1` vs `HEAD^1`:**
- En commits normales (con una sola lÃ­nea de commits anterior): **Son idÃ©nticos**
- En merge commits:
  - `HEAD~1` â†’ Siempre sigue la primera lÃ­nea
  - `HEAD^1` â†’ Primera lÃ­nea explÃ­citamente
  - `HEAD^2` â†’ Segunda lÃ­nea (rama mergeada)

**`HEAD@{1}` vs `HEAD~1`:**
- `HEAD~1` â†’ Commit anterior en el grafo de commits
- `HEAD@{1}` â†’ PosiciÃ³n anterior de HEAD (puede ser cualquier commit)

**Ejemplo:** [ğŸ”™](#41-referencias-de-commits---y-)

```bash
# Secuencia de operaciones:
git switch main      # HEAD en abc123
git switch feature   # HEAD en def456
git switch main      # HEAD en abc123 otra vez

# Ahora:
HEAD      â†’ abc123 (main)
HEAD~1    â†’ 789xyz (commit anterior a abc123 en el grafo)
HEAD@{1}  â†’ def456 (donde estaba HEAD antes: feature)
HEAD@{2}  â†’ abc123 (donde estaba antes de eso)
```

---

### âš ï¸ Advertencia Importante sobre HEAD^2

**HEAD^2 solo existe si el commit actual ES un merge commit:**

```bash
# Verificar si un commit es un merge:
git rev-list --parents -n 1 HEAD
# Si muestra 2+ hashes despuÃ©s del primero â†’ es merge
# Si muestra solo 2 hashes â†’ NO es merge (1 lÃ­nea)

# Ejemplo de error comÃºn:
git switch main
git log --oneline -1
# abc123 Add feature X  â† commit normal, no merge

git show HEAD^2
# fatal: ambiguous argument 'HEAD^2': unknown revision or path not in the working tree.

# Para ver la segunda lÃ­nea de un merge anterior:
git log --oneline --graph -5  # Identifica el merge commit
git show <hash-merge>^2        # Usa el hash del merge
# O si el merge estÃ¡ 2 commits atrÃ¡s:
git show HEAD~2^2              # Funciona si HEAD~2 es merge
```

**CÃ³mo identificar merge commits visualmente:**

```bash
# En git log:
git log --oneline --graph --all
# Los merges se ven asÃ­:
#   *   a1b2c3d Merge branch 'feature' into main  â† MERGE commit
#   |\  
#   | * d4e5f6g Add feature
#   * | h7i8j9k Fix bug
#   |/  
#   * k0l1m2n Initial commit
```

---

### Mejores PrÃ¡cticas

[ğŸ”™](#41-referencias-de-commits---y-)

```bash
âœ“ Usa ~ para navegar historia lineal
âœ“ Usa ^ para explorar merges
âœ“ Usa @{} para deshacer operaciones recientes
âœ“ Combina operadores para navegaciÃ³n compleja
âœ“ Usa git reflog para ver historial de operaciones
âœ“ Verifica que un commit sea merge antes de usar ^2

âœ— No confundas ~ (commits atrÃ¡s) con @{} (historial)
âœ— No uses ^2 en commits sin merge (da error)
âœ— No abuses de combinaciones complejas (dificulta lectura)
âœ— No asumas que HEAD siempre es un merge
```

---


---

## NavegaciÃ³n

- [â¬…ï¸ Anterior: git diff](04-git-diff.md)
- [ğŸ  Volver al Ãndice](../../GIT_COMANDOS_GUIA_PRACTICA.md)
- [â¡ï¸ Siguiente: git log](05-git-log.md)

